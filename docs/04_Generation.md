# 4. 패턴 생성: 인코딩된 파라미터의 시각화

## 4.1. 개요

앞선 장에서 우리는 가중치 행렬이 `HybridEncodedBlock`이라는 고도로 압축된 형태로 표현되며, 순전파 시점에 '즉석 합성'된다는 것을 확인했다. 이 과정은 연산 효율성을 극대화하지만, 그 자체로는 추상적이어서 엔지니어나 연구자가 모델의 내부 동작을 직관적으로 이해하기 어렵게 만든다.

본 장의 목표는 이 추상적인 인코딩된 파라미터들이 실제로 어떤 시각적 패턴(visual pattern)을 생성하는지를 명확히 보여주는 것이다. 각 파라미터 구성요소가 최종 가중치 패턴에 독립적으로, 그리고 복합적으로 어떻게 기여하는지를 분해하여 시각화함으로써, 모델의 해석 가능성(interpretability)과 디버깅 용이성을 확보하고자 한다.

## 4.2. 계층적 생성 모델 (Hierarchical Generation Model)

가중치 패턴 `W`는 세 개의 계층(layer)이 순차적으로 더해져 생성되는 계층적 모델로 이해할 수 있다.

**`W = Pattern_Base + Pattern_Continuous + Pattern_Residual`**

1.  **`Pattern_Base`**: `hi` 코어의 이산 상태가 결정하는 전역적(global)이고 구조적인 기저 패턴.
2.  **`Pattern_Continuous`**: `lo` 코어의 연속계 파라미터가 적용하는 거시적(macro)이고 부드러운 변형.
3.  **`Pattern_Residual`**: 희소 잔차 계수가 담당하는 국소적(local)이고 미시적인(micro) 최종 보정.

이제 각 계층의 패턴을 시각적으로 분석한다.

## 4.3. `Pattern_Base`: 상태-전이 코어(`hi`)의 시각화

`hi` 필드는 가중치 패턴의 가장 근본적인 형태와 구조를 결정한다. 이 필드의 각 비트 그룹을 변경했을 때 패턴이 어떻게 변하는지 시각화하면 그 역할을 명확히 알 수 있다. (모든 예시는 64x64 크기 행렬을 가정한다.)

### 4.3.1. 위상 상태(`phase_state`)의 시각적 효과

`frequency_quant`와 `amplitude_quant` 등 다른 모든 파라미터를 고정한 채, `phase_state` 비트(`[63:62]`)만 변경할 때 생성되는 패턴의 변화는 다음과 같다. 기저 함수로 `sin` 계열이 선택되었다고 가정한다.

| `phase_state` | 값 (의미) | 생성된 패턴 시각화 (2D Heatmap) | 설명 |
| :--- | :--- | :--- | :--- |
| `00` | `sin(f)` | (물결 모양 패턴) | 기본적인 `sin` 함수 형태의 패턴. |
| `01` | `cos(f)` | (물결이 90도 이동한 패턴) | `sin` 패턴이 위상 이동(phase shift)한 `cos` 형태. |
| `10` | `-sin(f)`| (sin 패턴의 색상이 반전된 모습) | `sin` 패턴의 진폭이 완전히 반전된 형태. |
| `11` | `-cos(f)`| (cos 패턴의 색상이 반전된 모습) | `cos` 패턴의 진폭이 완전히 반전된 형태. |

**분석**: `phase_state`는 패턴의 근본적인 형태(wave form)를 결정한다. 5장에서 논할 '상태-전이 미분'은 바로 이 시각적 형태들 간의 주기적 전환을 의미한다.

### 4.3.2. 주파수(`frequency_quant`)의 시각적 효과

`phase_state`를 `00(sin)`으로 고정한 채, `frequency_quant` 비트(`[61:50]`) 값을 변경하면 패턴의 '빽빽함'이 달라진다.

-   **낮은 주파수 값**: 패턴에 나타나는 물결의 개수가 적다. (예: 2~3개의 넓은 물결)
-   **높은 주파수 값**: 패턴에 나타나는 물결의 개수가 많다. (예: 10~15개의 좁은 물결)

이는 `frequency_quant`가 패턴의 공간적 주기(spatial period)를 제어함을 시각적으로 보여준다.

## 4.4. `Pattern_Continuous`: 연속계 코어(`lo`)의 시각화

`lo` 필드의 두 `f32` 파라미터는 `hi`가 생성한 `Pattern_Base` 위에 전역적인 변형을 가한다.

### 4.4.1. `r_fp32` (스케일)의 효과

-   **`r_fp32` > 1**: `Pattern_Base`의 진폭(최대/최소값의 차이)이 전체적으로 커진다. 히트맵에서 색상의 대비(contrast)가 더 강해지는 효과를 보인다.
-   **`r_fp32` < 1**: 패턴의 진폭이 전체적으로 작아진다. 색상 대비가 약해진다.

### 4.4.2. `theta_fp32` (오프셋)의 효과

-   **`theta_fp32` > 0**: `Pattern_Base`의 모든 값에 양수가 더해져, 패턴 전체가 전반적으로 '밝아지는' 효과를 보인다.
-   **`theta_fp32` < 0**: 패턴 전체가 전반적으로 '어두워지는' 효과를 보인다.

**종합**: `hi`와 `lo` 코어를 결합하여 생성된 `W_approx = Pattern_Base + Pattern_Continuous`는 원본 행렬의 핵심적인 저주파(low-frequency) 성분과 거시적 특징을 대부분 표현하게 된다.

## 4.5. `Pattern_Residual`: 최종 보정의 시각화

잔차 패턴은 `W_approx`가 잡아내지 못한 미세한 디테일을 표현한다.

1.  **`W_approx` (근사 행렬)**: 부드러운 물결 모양의 패턴.
2.  **`R = S - W_approx` (실제 잔차 행렬)**: 대부분의 영역이 0에 가깝고, 특정 부분(예: 경계선, 국소적 특이점)에서만 0이 아닌 값을 가지는 희소한(sparse) 형태의 패턴.
3.  **`Pattern_Residual` (압축된 잔차의 복원)**: `R`에 DCT/DWT를 적용 후 상위 K개 계수만으로 복원한 패턴. 원본 잔차 `R`의 가장 두드러진 특징들만을 유지하고 있다.
4.  **`W_final = W_approx + Pattern_Residual` (최종 행렬)**: `W_approx`의 부드러운 패턴 위에 `Pattern_Residual`의 날카로운 디테일이 더해져, 원본 행렬 `S`와 시각적으로 거의 구별할 수 없는 최종 패턴이 완성된다.

## 4.6. 결론

인코딩된 파라미터로부터 가중치 패턴이 생성되는 과정은 세 단계의 계층적 렌더링(rendering) 과정으로 시각화할 수 있다.

-   **1단계 (구조 정의)**: `hi` 코어가 패턴의 종류, 주기, 위상을 결정하여 뼈대를 잡는다.
-   **2단계 (전역 조정)**: `lo` 코어가 패턴의 대비와 밝기를 조절하여 전체적인 톤을 맞춘다.
-   **3단계 (미세 묘사)**: `residuals`가 국소적인 디테일을 추가하여 최종 완성도를 높인다.

이러한 계층적, 해석 가능한 생성 방식은 모델의 동작을 분석하고 디버깅하는 데 강력한 도구를 제공하며, 각 파라미터가 학습 과정에서 어떻게 변화하는지를 시각적으로 추적할 수 있게 한다. 